<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IP Geolocation API</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #fff;
      color: #333;
      line-height: 1.6;
    }
    header {
      background: black; /* Black banner as per your update */
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 28px;
      display: inline-block;
      vertical-align: middle;
    }
    header img {
      max-height: 50px;
      vertical-align: middle;
      margin-right: 10px;
    }
    nav {
      background: #f8f9fa;
      padding: 10px;
      text-align: center;
    }
    nav a {
      color: #007bff;
      margin: 0 15px;
      text-decoration: none;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 20px;
      display: flex;
      flex-wrap: wrap;
    }
    .search-section {
      width: 100%;
      text-align: center;
      margin-bottom: 20px;
    }
    .search-section input {
      padding: 10px;
      width: 300px;
      font-size: 16px;
    }
    .search-section button {
      padding: 10px 20px;
      background: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }
    .search-section button:hover {
      background: #0056b3;
    }
    .results {
      display: flex;
      width: 100%;
      gap: 20px;
    }
    .json-output {
      flex: 1;
      background: #f4f4f4;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .map {
      flex: 1;
      min-height: 400px;
      border: 1px solid #ccc;
    }
    pre {
      margin: 0;
      white-space: pre-wrap;
    }
    h2 {
      color: #007bff;
      margin-top: 30px;
    }
    p {
      font-size: 16px;
    }
    .docs, .examples {
      width: 100%;
      margin: 20px 0;
    }
    code {
      font-family: 'Courier New', Courier, monospace;
    }
    .example pre {
      background: #f4f4f4;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    #result, #map {
      display: none;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaocglvHIK3KkLkcr60jm0wlWmDK7KbwI"></script>
</head>
<body>
  <header>
    <img src="/logo.gif" alt="IP Geolocation API" style="max-height: 50px; vertical-align: middle;">
    <h1>IP Geolocation API</h1>
  </header>
  <nav>
    <a href="/">Home</a>
    <a href="#docs">API Docs</a>
    <a href="#examples">Examples</a>
  </nav>
  <div class="container">
    <div class="search-section">
      <h2>API Demo</h2>
      <input type="text" id="ipInput" placeholder="Search any IP address/domain (e.g., 8.8.8.8)">
      <button onclick="lookupIP()">SEARCH</button>
    </div>
    <div class="results">
      <div class="json-output" id="result"></div>
      <div class="map" id="map"></div>
    </div>
    <div class="docs" id="docs">
      <h2>API Documentation</h2>
      <p>Use the following endpoints to retrieve geolocation data (optional API key: <code>?key=abc123XYZ!</code>). Rate limit: 100 requests per IP per 15 minutes.</p>
      <ul>
        <li><code>/json/[ip]?key=abc123XYZ!</code> - JSON format (e.g., <a href="/json/8.8.8.8?key=abc123XYZ!">/json/8.8.8.8</a>)</li>
        <li><code>/xml/[ip]?key=abc123XYZ!</code> - XML format (e.g., <a href="/xml/8.8.8.8?key=abc123XYZ!">/xml/8.8.8.8</a>)</li>
        <li><code>/csv/[ip]?key=abc123XYZ!</code> - CSV format (e.g., <a href="/csv/8.8.8.8?key=abc123XYZ!">/csv/8.8.8.8</a>)</li>
      </ul>
    </div>
    <div class="examples" id="examples">
      <h2>Examples</h2>
      <div class="example">
        <h3>JSON</h3>
        <pre><code>GET /json/8.8.8.8?key=abc123XYZ!
{
  "status": "success",
  "query": "8.8.8.8",
  "country": "United States",
  "countryCode": "US",
  "region": "VA",
  "regionName": "Virginia",
  "city": "Ashburn",
  "lat": 39.03,
  "lon": -77.5,
  "timezone": "America/New_York",
  "isp": "Google",
  "organization": "Google",
  "userType": "business",
  "isAnonymous": false
}</code></pre>
      </div>
      <div class="example">
        <h3>XML</h3>
        <pre><code>GET /xml/8.8.8.8?key=abc123XYZ!
<response>
  <status>success</status>
  <query>8.8.8.8</query>
  <country>United States</country>
  <countryCode>US</countryCode>
  <region>VA</region>
  <regionName>Virginia</regionName>
  <city>Ashburn</city>
  <lat>39.03</lat>
  <lon>-77.5</lon>
  <timezone>America/New_York</timezone>
  <isp>Google</isp>
  <organization>Google</organization>
  <userType>business</userType>
  <isAnonymous>false</isAnonymous>
</response></code></pre>
      </div>
      <div class="example">
        <h3>CSV</h3>
        <pre><code>GET /csv/8.8.8.8?key=abc123XYZ!
"status","query","country","countryCode","region","regionName","city","lat","lon","timezone","isp","organization","userType","isAnonymous"
"success","8.8.8.8","United States","US","VA","Virginia","Ashburn",39.03,-77.5,"America/New_York","Google","Google","business",false</code></pre>
      </div>
    </div>
  </div>

  <script>
    async function lookupIP() {
      const ip = document.getElementById('ipInput').value || '8.8.8.8';
      console.log(`Fetching data for IP: ${ip}`);
      try {
        const response = await fetch(`/json/${ip}?key=abc123XYZ!`);
        console.log(`Response status: ${response.status}`);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        console.log(`Data received:`, data);
        document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        document.getElementById('result').style.display = 'block';
        try {
          const map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: data.lat, lng: data.lon },
            zoom: 12
          });
          new google.maps.Marker({
            position: { lat: data.lat, lng: data.lon },
            map: map,
            title: data.city + ', ' + data.regionName
          });
          document.getElementById('map').style.display = 'block';
          console.log('Map initialized successfully');
        } catch (mapError) {
          console.error('Map error:', mapError.message);
          document.getElementById('map').style.display = 'none';
          document.getElementById('result').textContent += `\nMap error: ${mapError.message}`;
        }
      } catch (err) {
        console.error('Fetch error:', err);
        document.getElementById('result').textContent = `Error fetching data: ${err.message}`;
        document.getElementById('result').style.display = 'block';
        document.getElementById('map').style.display = 'none';
      }
    }
    // Auto-run for default IP
    window.onload = () => lookupIP();
  </script>
</body>
</html>